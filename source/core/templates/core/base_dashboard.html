{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>{% block title %}Talent Track ‚Äì Panel{% endblock %}</title>

  <link rel="icon" type="image/png" href="{% static 'core/img/talentrack_small.svg' %}" />

  <script src="https://unpkg.com/htmx.org@1.9.12"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html {
      font-size: 14px;
    }

    @media (min-width: 1024px) {
      html {
        font-size: 14px;
      }
    }

    /* === FIX MODALES (Para que no salgan flotando) === */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1055;
      width: 100%;
      height: 100%;
      overflow-x: hidden;
      overflow-y: auto;
      outline: 0;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal.show {
      display: block;
    }

    .modal-dialog {
      position: relative;
      width: auto;
      margin: 1.75rem auto;
      pointer-events: none;
      max-width: 600px;
      transition: transform .3s ease-out;
      transform: translate(0, -50px);
    }

    .modal.show .modal-dialog {
      transform: none;
    }

    .modal-content {
      position: relative;
      display: flex;
      flex-direction: column;
      width: 100%;
      pointer-events: auto;
      background-color: #fff;
      background-clip: padding-box;
      border: 1px solid rgba(0, 0, 0, .2);
      border-radius: 0.5rem;
      outline: 0;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    .modal-dialog-centered {
      display: flex;
      align-items: center;
      min-height: calc(100% - 3.5rem);
    }

    /* === FIX SIDEBAR (Para que el bot√≥n funcione) === */
    #sidebar {
      transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* üëá ESTO ES LO QUE ARREGLA EL CLIC DEL BOT√ìN */
    #sidebar.is-collapsed:hover .sidebar-toggle {
      opacity: 1;
      pointer-events: auto;
    }

    #sidebar:not(.is-collapsed) .sidebar-toggle {
      opacity: 1;
      pointer-events: auto;
    }

    #sidebar.is-collapsed #logoSmall {
      display: block;
    }

    #sidebar.is-collapsed .sidebar-toggle {
      display: none;
    }

    #sidebar.is-collapsed:hover #logoSmall {
      display: none;
    }

    #sidebar.is-collapsed:hover .sidebar-toggle {
      display: flex;
    }

    #sidebar:not(.is-collapsed) #logoSmall {
      display: none;
    }

    #sidebar:not(.is-collapsed) .sidebar-toggle {
      display: flex;
    }

    #sidebar:not(.is-collapsed) .sidebar-toggle svg {
      transform: rotate(180deg);
    }

    .sidebar-toggle svg {
      transition: transform 0.2s ease;
    }

    [x-cloak] {
      display: none !important;
    }
  </style>
  {% block extra_css %}{% endblock %}
</head>

<body class="bg-slate-100 min-h-screen">
  <div class="min-h-screen flex">
    <aside id="sidebar"
      class="w-64 bg-white border-r border-slate-200 flex flex-col transition-all duration-200 ease-in-out">
      <div id="sidebarHeader" class="h-16 border-b border-slate-100 flex items-center justify-between px-3">
        <a href="{% url 'dashboard' %}" class="flex items-center gap-2 overflow-hidden">
          <img id="logoSmall" src="{% static 'core/img/talentrack_small.svg' %}" alt="Talent Track"
            class="h-8 w-8 hidden" />

          <img id="logoFull" src="{% static 'core/img/talenttrack_logo.svg' %}" alt="Talent Track" class="h-8 w-auto" />
        </a>

        <button type="button" id="sidebarToggle"
          class="sidebar-toggle w-9 h-9 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center opacity-0 pointer-events-none transition"
          aria-label="Abrir barra lateral" title="Abrir barra lateral">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
          </svg>
        </button>
      </div>

      <nav id="sidebarNav" class="flex-1 px-3 py-4 space-y-1 text-sm">
        <a href="{% url 'dashboard' %}" title="Panel"
          class="flex items-center gap-3 px-3 py-2 rounded-lg font-medium transition-colors {% if request.resolver_match.url_name == 'dashboard' %} bg-blue-50 text-blue-600 {% else %} text-slate-600 hover:bg-slate-100 {% endif %}">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
          </svg>
          <span class="sidebar-text">Panel</span>
        </a>

        <a href="{% url 'asistencia:inicio' %}" title="Asistencia del equipo"
          class="flex items-center gap-3 px-3 py-2 rounded-lg font-medium transition-colors {% if 'asistencia' in request.path %} bg-blue-50 text-blue-600 {% else %} text-slate-600 hover:bg-slate-100 {% endif %}">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
          </svg>
          <span class="sidebar-text">Asistencia del equipo</span>
        </a>

        <a href="{% url 'empleados:lista_empleados' %}" title="Empleados"
          class="flex items-center gap-3 px-3 py-2 rounded-lg font-medium transition-colors {% if 'empleados' in request.path %} bg-blue-50 text-blue-600 {% else %} text-slate-600 hover:bg-slate-100 {% endif %}">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z" />
          </svg>
          <span class="sidebar-text">Empleados</span>
        </a>

        <a href="{% url 'solicitudes:lista_solicitudes' %}" title="Solicitudes"
          class="flex items-center gap-3 px-3 py-2 rounded-lg font-medium transition-colors {% if 'solicitudes' in request.path %} bg-blue-50 text-blue-600 {% else %} text-slate-600 hover:bg-slate-100 {% endif %}">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 10v9a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-9" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 10l9 6 9-6" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 10V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v5" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 5h4" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 7h4" />
          </svg>
          <span class="sidebar-text">Solicitudes</span>
        </a>

        <a href="{% url 'organizacion' %}" title="Organizaci√≥n"
          class="flex items-center gap-3 px-3 py-2 rounded-lg font-medium transition-colors {% if 'organizacion' in request.path %} bg-blue-50 text-blue-600 {% else %} text-slate-600 hover:bg-slate-100 {% endif %}">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008Zm0 3h.008v.008h-.008v-.008Zm0 3h.008v.008h-.008v-.008Z" />
          </svg>
          <span class="sidebar-text">Organizaci√≥n</span>
        </a>

        {% if request.user.puede_ver_modulo_usuarios %}
        <a href="{% url 'usuarios:lista_usuarios' %}" title="Usuarios y Accesos"
          class="flex items-center gap-3 px-3 py-2 rounded-lg font-medium transition-colors {% if 'usuarios' in request.path %} bg-blue-50 text-blue-600 {% else %} text-slate-600 hover:bg-slate-100 {% endif %}">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
          </svg>
          <span class="sidebar-text">Usuarios y Accesos</span>
        </a>
        {% endif %}

        <a href="{% url 'kpi:dashboard' %}" title="KPI"
          class="flex items-center gap-3 px-3 py-2 rounded-lg font-medium transition-colors {% if 'kpi' in request.path %} bg-blue-50 text-blue-600 {% else %} text-slate-600 hover:bg-slate-100 {% endif %}">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
          </svg>
          <span class="sidebar-text">KPI</span>
        </a>

          <a
            href="{% url 'auditoria:dashboard' %}"
            title="Auditor√≠a"
            class="flex items-center gap-3 px-3 py-2 rounded-lg font-medium transition-colors {% if 'reportes' in request.path %} bg-blue-50 text-blue-600 {% else %} text-slate-600 hover:bg-slate-100 {% endif %}"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="size-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25M9 16.5v.75m3-3v3M15 12v5.25m-4.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"
              />
            </svg>
            <span class="sidebar-text">Auditor√≠a</span>
          </a>
          {% if request.user.is_superuser %}
          <a
            href="{% url 'integraciones:dashboard' %}"
            title="Integraciones"
            class="flex items-center gap-3 px-3 py-2 rounded-lg font-medium transition-colors {% if 'integracion' in request.path %} bg-blue-50 text-blue-600 {% else %} text-slate-600 hover:bg-slate-100 {% endif %}"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="size-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"
              />
            </svg>
            <span class="sidebar-text">Integraciones</span>
          </a>
          {% endif %}
          <a
            href="{% url 'poa:poa' %}"
            title="POA"
            class="flex items-center gap-3 px-3 py-2 rounded-lg font-medium transition-colors {% if 'poa' in request.path %} bg-blue-50 text-blue-600 {% else %} text-slate-600 hover:bg-slate-100 {% endif %}"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="size-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M8.25 3.75h7.5c.621 0 1.125.504 1.125 1.125v14.25c0 .621-.504 1.125-1.125 1.125h-7.5c-.621 0-1.125-.504-1.125-1.125V4.875c0-.621.504-1.125 1.125-1.125Z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9.75 8.25h4.5"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9.75 11.25h4.5"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9.75 14.25h4.5"
              />
            </svg>

          <span class="sidebar-text">POA</span>
        </a>
      </nav>
    </aside>

    <div id="mainContent" class="flex-1 flex flex-col">
      <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6">

        <div class="flex items-center">
          <div>
            <h1 class="text-lg font-semibold text-slate-900">
              {% block header_title %}Panel General{% endblock %}
            </h1>
            <p class="text-xs text-slate-500">
              {% block header_subtitle %}Bienvenido al sistema de gesti√≥n Talent Track{% endblock %}
            </p>
          </div>

          {% if es_superadmin_global and lista_empresas_global %}
          <div class="hidden md:flex items-center ml-6 border-l border-slate-200 pl-6" id="globalCompanyContainer">
            <div class="relative">
              <button onclick="toggleGlobalDropdown()"
                class="flex items-center gap-3 bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 hover:border-blue-300 hover:bg-blue-50 transition-all cursor-pointer group">

                <div class="flex flex-col items-start text-left">
                  <span class="text-[9px] font-bold text-slate-400 uppercase tracking-wider">Entorno:</span>
                  <span class="text-xs font-bold text-slate-700 group-hover:text-blue-700 truncate max-w-[150px]">
                    {{ empresa_actual.nombre_comercial|default:"Seleccionar Empresa" }}
                  </span>
                </div>

                <svg id="globalArrow" xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4 text-slate-400 group-hover:text-blue-500 transition-transform duration-200" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>

              <div id="globalCompanyMenu"
                class="hidden absolute left-0 mt-2 w-64 bg-white rounded-lg shadow-xl border border-slate-100 z-50 overflow-hidden origin-top-left">
                <div class="max-h-80 overflow-y-auto custom-scrollbar">
                  {% for emp in lista_empresas_global %}
                  <a href="?empresa_id={{ emp.id }}"
                    class="flex items-center justify-between px-4 py-2.5 hover:bg-blue-50 transition-colors border-b border-slate-50 last:border-0 group">
                    <span
                      class="text-xs font-medium truncate {% if empresa_actual.id == emp.id %}text-blue-600 font-bold{% else %}text-slate-600 group-hover:text-blue-600{% endif %}">
                      {{ emp.nombre_comercial }}
                    </span>
                    {% if empresa_actual.id == emp.id %}
                    <span class="w-1.5 h-1.5 rounded-full bg-blue-500"></span>
                    {% endif %}
                  </a>
                  {% endfor %}
                </div>
              </div>
            </div>

            <script>
              function toggleGlobalDropdown() {
                const menu = document.getElementById('globalCompanyMenu');
                const arrow = document.getElementById('globalArrow');
                if (menu && arrow) {
                  menu.classList.toggle('hidden');
                  arrow.style.transform = menu.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
                }
              }

              window.addEventListener('click', function (e) {
                const container = document.getElementById('globalCompanyContainer');
                const menu = document.getElementById('globalCompanyMenu');
                const arrow = document.getElementById('globalArrow');
                if (container && !container.contains(e.target) && menu && !menu.classList.contains('hidden')) {
                  menu.classList.add('hidden');
                  if (arrow) arrow.style.transform = 'rotate(0deg)';
                }
              });
            </script>
          </div>
          {% endif %}
        </div>

          <div class="flex items-center gap-4 text-slate-500">
            <div class="relative">
    
    <button id="notifBtn" onclick="toggleNotificaciones(event)" class="w-8 h-8 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition-colors relative focus:outline-none">
        
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 text-slate-600">
            <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
        </svg>

        {% if notif_count > 0 %}
        <span class="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-red-600 text-[9px] font-bold text-white ring-2 ring-white animate-pulse">
            {{ notif_count }}
        </span>
        {% endif %}
    </button>

    <div id="notifMenu" class="hidden absolute right-0 top-full mt-2 w-80 origin-top-right rounded-xl bg-white shadow-xl ring-1 ring-black ring-opacity-5 z-50">
        
        <div class="px-4 py-3 border-b border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-xl">
            <h3 class="text-xs font-bold text-slate-700 uppercase tracking-wide">Notificaciones</h3>
            {% if notif_count > 0 %}
                <a href="{% url 'notificaciones:marcar_todas' %}" class="text-[10px] font-bold text-blue-600 hover:text-blue-700 hover:underline">
                    Marcar le√≠das
                </a>
            {% endif %}
        </div>
        
        <div class="max-h-64 overflow-y-auto">
            {% for notif in notif_list %}
            <a href="{{ notif.link|default:'#' }}" class="block p-3 hover:bg-slate-50 transition border-b border-slate-50 last:border-0 group/item">
                <div class="flex gap-3 items-start">
                    <div class="flex-shrink-0 mt-1.5">
                        {% if notif.tipo == 'success' %}
                            <div class="w-2 h-2 rounded-full bg-green-500 shadow-sm shadow-green-200"></div>
                        {% elif notif.tipo == 'warning' %}
                            <div class="w-2 h-2 rounded-full bg-yellow-500 shadow-sm shadow-yellow-200"></div>
                        {% elif notif.tipo == 'error' %}
                            <div class="w-2 h-2 rounded-full bg-red-500 shadow-sm shadow-red-200"></div>
                        {% else %}
                            <div class="w-2 h-2 rounded-full bg-blue-500 shadow-sm shadow-blue-200"></div>
                        {% endif %}
                    </div>
                    
                    <div class="flex-1">
                        <p class="text-xs font-bold {% if not notif.leido %}text-slate-800{% else %}text-slate-500{% endif %} group-hover/item:text-blue-600 transition-colors">
                            {{ notif.titulo }}
                        </p>
                        <p class="text-[11px] text-slate-500 mt-0.5 line-clamp-2 leading-snug">
                            {{ notif.mensaje }}
                        </p>
                        <p class="text-[9px] text-slate-400 mt-1.5 font-medium">
                            {{ notif.fecha_creacion|timesince }}
                        </p>
                    </div>
                </div>
            </a>
            {% empty %}
            <div class="py-8 text-center flex flex-col items-center justify-center text-slate-400">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 mb-2 opacity-50">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
                </svg>
                <p class="text-xs">Sin novedades</p>
            </div>
            {% endfor %}
        </div>
        
        <div class="p-2 border-t border-slate-100 bg-slate-50 rounded-b-xl text-center">
            <a href="{% url 'notificaciones:listar' %}" class="block w-full py-1 text-[10px] font-bold text-slate-500 hover:text-slate-800 transition-colors uppercase tracking-wide">
                Ver historial
            </a>
        </div>
    </div>
</div>

<script>
    function toggleNotificaciones(event) {
        event.stopPropagation(); // Evita que el clic se propague y cierre el men√∫ inmediatamente
        const menu = document.getElementById('notifMenu');
        menu.classList.toggle('hidden');
    }

    // Cerrar men√∫ al hacer clic en cualquier otro lado
    document.addEventListener('click', function(event) {
        const menu = document.getElementById('notifMenu');
        const btn = document.getElementById('notifBtn');
        
        // Si el men√∫ est√° abierto... Y el clic NO fue dentro del men√∫... Y NO fue en el bot√≥n...
        if (!menu.classList.contains('hidden') && !menu.contains(event.target) && event.target !== btn) {
            menu.classList.add('hidden'); // Lo cerramos
        }
    });
</script>

          <button class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center hover:bg-slate-200">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
            </svg>
          </button>

          <div class="flex items-center gap-2">
            <div
              class="w-9 h-9 rounded-full bg-blue-500 text-white flex items-center justify-center text-[10px] font-semibold text-center px-1">
              {{ request.user.username|slice:":2"|upper }}
            </div>

            <form method="post" action="{% url 'logout' %}">
              {% csrf_token %}
              <button type="submit" class="flex items-center gap-2 text-slate-600 hover:text-red-600 text-xs transition"
                title="Cerrar sesi√≥n">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                  stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M8.25 9V5.25A2.25 2.25 0 0 1 10.5 3h6a2.25 2.25 0 0 1 2.25 2.25v13.5A2.25 2.25 0 0 1 16.5 21h-6a2.25 2.25 0 0 1-2.25-2.25V15m-3 0-3-3m0 0 3-3m-3 3H15" />
                </svg>
              </button>
            </form>
          </div>
        </div>
      </header>

      {% if messages %}
      <div class="max-w-6xl mx-auto mt-3 space-y-2">
        {% for message in messages %}
        <div
          class="px-4 py-2 rounded-xl text-sm {% if message.tags == 'error' %} bg-red-50 text-red-700 border border-red-200 {% elif message.tags == 'success' %} bg-green-50 text-green-700 border border-green-200 {% else %} bg-slate-50 text-slate-700 border border-slate-200 {% endif %}">
          {{ message }}
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <main class="flex-1 p-6 w-full">
        <div class="w-full">{% block page_content %}{% endblock %}</div>
      </main>
    </div>
  </div>

  <script>
    const sidebar = document.getElementById("sidebar");
    const toggleBtn = document.getElementById("sidebarToggle");
    const sidebarTexts = document.querySelectorAll(".sidebar-text");

    const logoSmall = document.getElementById("logoSmall");
    const logoFull = document.getElementById("logoFull");

    function setCollapsed(collapsed) {
      if (collapsed) {
        sidebar.classList.remove("w-64");
        sidebar.classList.add("w-16");
        sidebar.classList.add("is-collapsed");

        sidebarTexts.forEach((el) => el.classList.add("hidden"));

        document.querySelectorAll("#sidebarNav a").forEach((a) => {
          a.classList.add("justify-center");
          a.classList.remove("gap-3", "px-3");
          a.classList.add("px-2");
        });

        if (logoSmall) logoSmall.classList.remove("hidden");
        if (logoFull) logoFull.classList.add("hidden");

        localStorage.setItem("sidebarCollapsed", "1");
      } else {
        sidebar.classList.remove("w-16");
        sidebar.classList.add("w-64");
        sidebar.classList.remove("is-collapsed");

        sidebarTexts.forEach((el) => el.classList.remove("hidden"));

        document.querySelectorAll("#sidebarNav a").forEach((a) => {
          a.classList.remove("justify-center");
          a.classList.remove("px-2");
          a.classList.add("gap-3", "px-3");
        });

        if (logoSmall) logoSmall.classList.add("hidden");
        if (logoFull) logoFull.classList.remove("hidden");

        localStorage.setItem("sidebarCollapsed", "0");
      }
    }

    function toggleSidebar() {
      const isCollapsed = sidebar.classList.contains("is-collapsed");
      setCollapsed(!isCollapsed);
    }

    toggleBtn.addEventListener("click", toggleSidebar);

    const saved = localStorage.getItem("sidebarCollapsed");
    setCollapsed(saved === "1");
  </script>
  {% block extra_js %}{% endblock %}
</body>

</html>