{% if success %}
  <div hx-swap-oob="outerHTML:#metas-container">
    {{ lista_html|safe }}
  </div>


  <div hx-swap-oob="innerHTML:#objetivo-header">
    {{ header_html|safe }}
  </div>

  <script>
    document.getElementById('modalMetaCrear').classList.add('hidden');
    Swal.fire({
      toast: true,
      position: 'top-end',
      showConfirmButton: false,
      timer: 3000,
      icon: 'success',
      title: '{% if is_edit %}¡Meta actualizada!{% else %}¡Meta creada!{% endif %}'
    });
  </script>
{% else %}
  <!-- SOLO EN ERROR se vuelve a renderizar el formulario -->
  <div id="modal-meta-content" class="relative transform overflow-hidden rounded-xl bg-white shadow-2xl sm:max-w-2xl border">
    <form
      id="form-meta-crear"
      method="post"
      hx-post="{% if is_edit %}{{ edit_url }}{% else %}{% url 'poa:meta_crear' objetivo.id %}{% endif %}"
      hx-target="#modal-meta-content"
      hx-swap="outerHTML"
      class="flex flex-col h-full"
    >
      {% csrf_token %}
    <div class="bg-slate-50 px-4 py-3 sm:px-6 flex justify-between items-center border-b border-slate-100">
      <h3 class="text-lg font-semibold leading-6 text-slate-900">
        {% if is_edit %}Editar meta{% else %}Nueva meta{% endif %}
      </h3>
      <button type="button" onclick="document.getElementById('modalMetaCrear').classList.add('hidden')" class="text-slate-400 hover:text-slate-500 transition-colors">
        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
      </button>
    </div>

    <div class="px-4 py-5 sm:p-6 space-y-4">
        {% if meta_form.non_field_errors %}
        <div class="rounded-md bg-red-50 p-3 mb-4 border border-red-100">
            <div class="text-sm text-red-700">{{ meta_form.non_field_errors|join:", " }}</div>
        </div>
        {% endif %}
        
        <style>
            #form-meta-crear input, #form-meta-crear textarea, #form-meta-crear select {
               width: 100%; border-radius: 0.5rem; border-color: #cbd5e1; font-size: 0.875rem; padding: 0.5rem 0.75rem; margin-top: 0.25rem;
            }
        </style>

        <div class="space-y-4">
            <div><label class="block text-sm font-medium text-slate-700">{{ meta_form.nombre.label }}</label>{{ meta_form.nombre }}</div>
            <div><label class="block text-sm font-medium text-slate-700">{{ meta_form.descripcion.label }}</label>{{ meta_form.descripcion }}</div>
            <div><label class="block text-sm font-medium text-slate-700">{{ meta_form.indicador.label }}</label>{{ meta_form.indicador }}</div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium text-slate-700">{{ meta_form.valor_esperado.label }}</label>{{ meta_form.valor_esperado }}</div>
                <div><label class="block text-sm font-medium text-slate-700">{{ meta_form.valor_actual.label }}</label>{{ meta_form.valor_actual }}</div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium text-slate-700">{{ meta_form.fecha_inicio.label }}</label>{{ meta_form.fecha_inicio }}</div>
                <div><label class="block text-sm font-medium text-slate-700">{{ meta_form.fecha_fin.label }}</label>{{ meta_form.fecha_fin }}</div>
            </div>

            <div><label class="block text-sm font-medium text-slate-700">{{ meta_form.estado.label }}</label>{{ meta_form.estado }}</div>
        </div>
    </div>

    <div class="bg-slate-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 gap-2 border-t border-slate-100 rounded-b-xl">
        <button type="submit" class="inline-flex w-full justify-center rounded-lg bg-blue-600 px-3 py-2 text-sm font-semibold text-white hover:bg-blue-500 sm:w-auto">Guardar</button>
        <button type="button" onclick="document.getElementById('modalMetaCrear').classList.add('hidden')" class="mt-3 inline-flex w-full justify-center rounded-lg bg-white px-3 py-2 text-sm font-semibold text-slate-900 ring-1 ring-inset ring-slate-300 hover:bg-slate-50 sm:mt-0 sm:w-auto">Cancelar</button>
    </div>
  </form>
</div>
{% endif %}