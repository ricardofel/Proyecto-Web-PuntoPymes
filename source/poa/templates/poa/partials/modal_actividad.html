{% if success %}
  <!-- Refresca la lista de metas y cierra el modal de actividad -->
  <div hx-swap-oob="innerHTML:#metas-container">{{ lista_html|safe }}</div>
  <script>
    (function() {
      document.getElementById('modalActividadCrear').classList.add('hidden');
      Swal.fire({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 3000,
        icon: 'success',
        title: '{% if is_edit %}Actividad actualizada{% else %}Actividad creada{% endif %}'
      });
    })();
  </script>
{% endif %}

<div 
  id="modal-actividad-content" 
  class="relative transform overflow-hidden rounded-xl bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-lg border border-slate-100"
>
  <form
    id="form-actividad-crear"
    method="post"
    hx-post="{% if is_edit %}{{ edit_url }}{% else %}{% url 'poa:actividad_crear' meta_id %}{% endif %}"
    hx-target="#modal-actividad-content"
    hx-swap="outerHTML"
    class="flex flex-col h-full"
  >
    {% csrf_token %}

    <div class="bg-slate-50 px-4 py-3 sm:px-6 flex justify-between items-start border-b border-slate-100">
      <div>
        <h3 class="text-lg font-bold leading-6 text-slate-900">
            {% if is_edit %}Editar Actividad{% else %}Nueva Actividad{% endif %}
        </h3>
        {% if not is_edit %}
          <p class="text-xs text-slate-500 mt-1">
            Para: <span class="font-medium">{{ meta_nombre }}</span>
          </p>
        {% endif %}
      </div>
      <button
        type="button"
        onclick="document.getElementById('modalActividadCrear').classList.add('hidden')"
        class="text-slate-400 hover:text-slate-500"
      >
        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <div class="px-4 py-5 sm:p-6 space-y-4">
      {% if form.non_field_errors %}
      <div class="rounded-md bg-red-50 p-3 mb-4 border border-red-100 text-sm text-red-700">
        {{ form.non_field_errors|join:", " }}
      </div>
      {% endif %}

      <style>
        #form-actividad-crear input,
        #form-actividad-crear textarea,
        #form-actividad-crear select {
           width: 100%;
           border-radius: 0.5rem;
           border-color: #cbd5e1;
           font-size: 0.875rem;
           padding: 0.5rem 0.75rem;
           margin-top: 0.25rem;
        }
      </style>

      <div class="space-y-4">
        {% if form.ejecutores %}
          <div>
            <label class="block text-xs font-bold text-slate-500 uppercase">Asignar a</label>
            {{ form.ejecutores }}
          </div>
        {% endif %}

        <div>
          <label class="block text-xs font-bold text-slate-500 uppercase">{{ form.nombre.label }}</label>
          {{ form.nombre }}
        </div>

        <div>
          <label class="block text-xs font-bold text-slate-500 uppercase">{{ form.descripcion.label }}</label>
          {{ form.descripcion }}
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-bold text-slate-500 uppercase">{{ form.fecha_inicio.label }}</label>
            {{ form.fecha_inicio }}
          </div>
          <div>
            <label class="block text-xs font-bold text-slate-500 uppercase">{{ form.fecha_fin.label }}</label>
            {{ form.fecha_fin }}
          </div>
        </div>

        <div>
          <label class="block text-xs font-bold text-slate-500 uppercase">Estado inicial</label>
          {{ form.estado }}
        </div>
      </div>
    </div>

    <div class="bg-slate-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 gap-2 border-t border-slate-100 rounded-b-xl">
      <button type="submit" class="inline-flex w-full justify-center rounded-lg bg-blue-600 px-3 py-2 text-sm font-semibold text-white hover:bg-blue-500 sm:w-auto">
        Guardar
      </button>
      <button
        type="button"
        onclick="document.getElementById('modalActividadCrear').classList.add('hidden')"
        class="mt-3 inline-flex w-full justify-center rounded-lg bg-white px-3 py-2 text-sm font-semibold text-slate-900 ring-1 ring-inset ring-slate-300 hover:bg-slate-50 sm:mt-0 sm:w-auto"
      >
        Cancelar
      </button>
    </div>
  </form>
</div>
